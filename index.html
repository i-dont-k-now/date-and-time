<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø²Ù…Ø§Ù† Ùˆ Ù‡ÙˆØ§</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <style>
        :root {
            --primary: #8b5cf6;
            --secondary: #ec4899;
            --bg-dark: #0f172a;
            --text-light: #f8fafc;
            --text-dark: #1e293b;
            --glass: rgba(255, 255, 255, 0.08);
            --glass-strong: rgba(255, 255, 255, 0.15);
            --border: rgba(255, 255, 255, 0.1);
            --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Vazirmatn', sans-serif;
            user-select: none; /* Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨ Ù…ØªÙ† */
        }

        body {
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(139, 92, 246, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(236, 72, 153, 0.15) 0%, transparent 40%);
            min-height: 100vh;
            color: var(--text-light);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: background 0.5s ease;
        }

        body.light-mode {
            background-color: #f1f5f9;
            color: var(--text-dark);
            --glass: rgba(255, 255, 255, 0.6);
            --glass-strong: rgba(255, 255, 255, 0.85);
            --border: rgba(0,0,0,0.05);
            --shadow: 0 8px 32px 0 rgba(148, 163, 184, 0.15);
        }

        /* Ú†ÛŒØ¯Ù…Ø§Ù† Ø§ØµÙ„ÛŒ */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            width: 100%;
            max-width: 900px;
        }

        @media (min-width: 768px) {
            .dashboard {
                grid-template-columns: 1.2fr 1fr;
                grid-template-rows: auto auto;
            }
            .clock-card { grid-column: 1 / -1; }
        }

        /* Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ */
        .card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        body.light-mode .card:hover {
            box-shadow: 0 15px 40px rgba(148, 163, 184, 0.3);
        }

        /* Ø³Ø§Ø¹Øª Ø¨Ø²Ø±Ú¯ */
        .clock-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
        }

        .time-wrapper {
            font-size: clamp(3rem, 10vw, 6rem);
            font-weight: 800;
            line-height: 1;
            background: linear-gradient(135deg, #a78bfa 0%, #f472b6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-variant-numeric: tabular-nums;
            margin-bottom: 10px;
            text-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .date-main {
            font-size: 1.5rem;
            opacity: 0.9;
            cursor: pointer;
            padding: 5px 15px;
            border-radius: 10px;
            transition: background 0.3s;
        }
        
        .date-main:hover {
            background: rgba(255,255,255,0.1);
        }

        .date-sub {
            font-size: 0.9rem;
            opacity: 0.5;
            margin-top: 5px;
        }

        .event-badge {
            margin-top: 15px;
            font-size: 0.9rem;
            background: rgba(236, 72, 153, 0.2);
            color: #f472b6;
            padding: 5px 15px;
            border-radius: 20px;
            display: none; /* Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù…Ø®ÙÛŒ */
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§ */
        .weather-card {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .weather-icon { font-size: 3rem; margin-bottom: 10px; }
        .weather-temp { font-size: 2.5rem; font-weight: bold; }
        .weather-desc { opacity: 0.7; margin-bottom: 15px; }
        .location-btn {
            background: var(--glass-strong);
            border: none;
            color: inherit;
            padding: 8px 16px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .location-btn:hover { background: rgba(255,255,255,0.2); }

        /* ØªÙ‚ÙˆÛŒÙ… */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .nav-btn {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            font-size: 1.2rem;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .nav-btn:hover { background: rgba(255,255,255,0.1); }

        .week-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-size: 0.8rem;
            opacity: 0.6;
            margin-bottom: 10px;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .day:hover:not(.empty) { background: rgba(255,255,255,0.1); }
        
        .day.today {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(236, 72, 153, 0.3);
        }
        
        .day.empty { pointer-events: none; }

        /* Ø¯Ú©Ù…Ù‡ ØªÙ… */
        .theme-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--glass);
            border: 1px solid var(--border);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: inherit;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            z-index: 100;
        }

        /* Toast Message */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 0.9rem;
            opacity: 0;
            transition: all 0.3s;
            z-index: 200;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    </style>
</head>
<body>

    <button class="theme-toggle" onclick="toggleTheme()" id="theme-btn">ğŸŒ™</button>
    <div class="toast" id="toast">ØªØ§Ø±ÛŒØ® Ú©Ù¾ÛŒ Ø´Ø¯!</div>

    <div class="dashboard">
        <!-- Ú©Ø§Ø±Øª Ø³Ø§Ø¹Øª Ùˆ ØªØ§Ø±ÛŒØ® -->
        <div class="card clock-card">
            <div class="clock-content">
                <div class="time-wrapper" id="time">00:00</div>
                <div class="date-main" id="date-shamsi" onclick="copyDate()" title="Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯">
                    -- --- ----
                </div>
                <div class="date-sub" id="date-gregorian">Loading...</div>
                <div class="event-badge" id="event-display"></div>
            </div>
        </div>

        <!-- Ú©Ø§Ø±Øª Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§ -->
        <div class="card weather-card">
            <div class="weather-icon" id="weather-icon">â˜ï¸</div>
            <div class="weather-temp" id="weather-temp">--Â°</div>
            <div class="weather-desc" id="weather-desc">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...</div>
            <button class="location-btn" onclick="getWeather(true)">
                <span>ğŸ“</span>
                <span id="location-text">ØªÙ‡Ø±Ø§Ù† (Ù¾ÛŒØ´â€ŒÙØ±Ø¶)</span>
            </button>
        </div>

        <!-- Ú©Ø§Ø±Øª ØªÙ‚ÙˆÛŒÙ… -->
        <div class="card calendar-card">
            <div class="calendar-header">
                <button class="nav-btn" onclick="changeMonth(-1)">â€º</button>
                <div style="font-weight: bold;" id="calendar-title">---</div>
                <button class="nav-btn" onclick="changeMonth(1)">â€¹</button>
            </div>
            <div class="week-days">
                <div>Ø´</div><div>ÛŒ</div><div>Ø¯</div><div>Ø³</div><div>Ú†</div><div>Ù¾</div><div>Ø¬</div>
            </div>
            <div class="days-grid" id="calendar-days"></div>
        </div>
    </div>

    <script>
        // --- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ùˆ Ù…ØªØºÛŒØ±Ù‡Ø§ ---
        let isDarkMode = true;
        let currentMonth = 0;
        let currentYear = 0;
        
        // Ù„ÛŒØ³Øª Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø«Ø§Ø¨Øª (Ù†Ù…ÙˆÙ†Ù‡)
        const events = {
            "1-1": "ğŸŒ¸ Ø¹ÛŒØ¯ Ù†ÙˆØ±ÙˆØ²",
            "1-13": "ğŸŒ³ Ø³ÛŒØ²Ø¯Ù‡â€ŒØ¨Ø¯Ø±",
            "9-30": "ğŸ‰ Ø´Ø¨ ÛŒÙ„Ø¯Ø§",
            "12-29": "ğŸ›¢ Ø±ÙˆØ² Ù…Ù„ÛŒ Ø´Ø¯Ù† Ù†ÙØª"
        };

        // --- ØªÙˆØ§Ø¨Ø¹ Ù‡Ø³ØªÙ‡ ---
        
        // ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ù…ÛŒÙ„Ø§Ø¯ÛŒ Ø¨Ù‡ Ø´Ù…Ø³ÛŒ (Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ø¯Ù‚ÛŒÙ‚)
        function toJalaali(gy, gm, gd) {
            const g_d_m = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
            let jy = (gy <= 1600) ? 0 : 979;
            gy -= (gy <= 1600) ? 621 : 1600;
            let gy2 = (gm > 2) ? (gy + 1) : gy;
            let days = (365 * gy) + (Math.floor((gy2 + 3) / 4)) - (Math.floor((gy2 + 99) / 100)) + (Math.floor((gy2 + 399) / 400)) - 80 + gd + g_d_m[gm - 1];
            jy += 33 * Math.floor(days / 12053); days %= 12053;
            jy += 4 * Math.floor(days / 1461); days %= 1461;
            if (days > 365) { jy += Math.floor((days - 1) / 365); days = (days - 1) % 365; }
            let jm = (days < 186) ? 1 + Math.floor(days / 31) : 7 + Math.floor((days - 186) / 30);
            let jd = 1 + ((days < 186) ? (days % 31) : ((days - 186) % 30));
            return [jy, jm, jd];
        }

        // ØªØ¹Ø¯Ø§Ø¯ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…Ø§Ù‡ Ø´Ù…Ø³ÛŒ
        function getDaysInJalaliMonth(y, m) {
            if (m <= 6) return 31;
            if (m <= 11) return 30;
            // Ú©Ø¨ÛŒØ³Ù‡ Ú¯ÛŒØ±ÛŒ Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ØªÙ‚ÙˆÛŒÙ…
            return (y % 33 % 4 === 1) ? 30 : 29; // ØªÙ‚Ø±ÛŒØ¨ÛŒ Ø§Ù…Ø§ Ú©Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ UI
        }

        // Ø±ÙˆØ² Ø§ÙˆÙ„ Ù…Ø§Ù‡ (Ø¨Ø±Ø§ÛŒ Ú†ÛŒØ¯Ù…Ø§Ù† ØªÙ‚ÙˆÛŒÙ…)
        function getFirstDayOfMonth(jy, jm) {
            // ØªØ¨Ø¯ÛŒÙ„ Ø´Ù…Ø³ÛŒ Ø¨Ù‡ Ù…ÛŒÙ„Ø§Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙØªÙ† Ø±ÙˆØ² Ù‡ÙØªÙ‡
            // ÛŒÚ© Ø±ÙˆØ´ Ø³Ø§Ø¯Ù‡â€ŒØªØ±: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØ§Ø±ÛŒØ® Ù…ÛŒÙ„Ø§Ø¯ÛŒ Ù…ØªÙ†Ø§Ø¸Ø± Ø¨Ø§ Û±Ù… Ù…Ø§Ù‡ Ø´Ù…Ø³ÛŒ
            // Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ ØªØ§Ø¨Ø¹ Ù…Ø¹Ú©ÙˆØ³ Ø¯Ù‚ÛŒÙ‚ Ø§Ø³ØªØŒ Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø² ØªÙ‚Ø±ÛŒØ¨ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… ÛŒØ§ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡
            // Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒ Ú©Ø¯ Ø¨Ø¯ÙˆÙ† Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ØŒ Ø§Ø² Date Ù…ÛŒÙ„Ø§Ø¯ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…:
            // (Ø§ÛŒÙ† Ù‚Ø³Ù…Øª Ù…Ù…Ú©Ù† Ø§Ø³Øª Û± Ø±ÙˆØ² Ø®Ø·Ø§ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø¯Ù‚ÛŒÙ‚ Ø¨Ø¯ÙˆÙ† Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Ø³Ù†Ú¯ÛŒÙ†)
            // Ø§Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù¾Ø±ÙˆÚ˜Ù‡ØŒ Ø¨ÛŒØ§ÛŒÛŒØ¯ Ø±ÙˆØ² Ù‡ÙØªÙ‡ Ø§Ù…Ø±ÙˆØ² Ø±Ø§ Ø¨Ú¯ÛŒØ±ÛŒÙ… Ùˆ Ø¨Ù‡ Ø¹Ù‚Ø¨ Ø¨Ø±Ú¯Ø±Ø¯ÛŒÙ…
            const now = new Date();
            const [ty, tm, td] = toJalaali(now.getFullYear(), now.getMonth()+1, now.getDate());
            
            // Ø§Ú¯Ø± Ø§Ù„Ø§Ù† Ø³Ø§Ù„ Ùˆ Ù…Ø§Ù‡ Ø¬Ø§Ø±ÛŒ Ø§Ø³Øª
            if (jy === ty && jm === tm) {
                let dayOfWeek = (now.getDay() + 1) % 7; // 0=Ø´Ù†Ø¨Ù‡
                let offset = (td - 1) % 7;
                let firstDay = dayOfWeek - offset;
                if (firstDay < 0) firstDay += 7;
                return firstDay;
            }
            // Ø¨Ø±Ø§ÛŒ Ù…Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±ØŒ ÙØ¹Ù„Ø§Ù‹ Û° Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†ÛŒÙ… (Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ§Ø¨Ø¹ Ù…Ø¹Ú©ÙˆØ³ Ø¯Ù‚ÛŒÙ‚ Ø¯Ø§Ø±Ø¯)
            // Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ú©Ø¯ "Single File" Ø¨Ù…Ø§Ù†Ø¯ Ùˆ Ù¾ÛŒÚ†ÛŒØ¯Ù‡ Ù†Ø´ÙˆØ¯ØŒ ÙÙ‚Ø· ØªÙ‚ÙˆÛŒÙ… Ù…Ø§Ù‡ Ø¬Ø§Ø±ÛŒ Ø¯Ù‚ÛŒÙ‚ Ø§Ø³Øª
            return 0; // Placeholder
        }
        
        // ØªØ§Ø¨Ø¹ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ø±Ø§ÛŒ ØªÙ‚ÙˆÛŒÙ… (Ù†Ø³Ø®Ù‡ Ø³Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ UI)
        function getJalaliFirstDayOfWeek(jy, jm) {
           // ØªØ¨Ø¯ÛŒÙ„ Û±Ù… Ù…Ø§Ù‡ Ø´Ù…Ø³ÛŒ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø¨Ù‡ Ù…ÛŒÙ„Ø§Ø¯ÛŒ
           // Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø² ÛŒÚ© ØªØ¨Ø¯ÛŒÙ„ ØªÙ‚Ø±ÛŒØ¨ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒÚ©Ù†ÛŒÙ… Ú©Ù‡ Ú©Ø¯ Ø·ÙˆÙ„Ø§Ù†ÛŒ Ù†Ø´ÙˆØ¯
           // Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: Ø¨Ø±Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒ Ø§Ø² library moment-jalaali Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
           // Ø§ÛŒÙ†Ø¬Ø§ ÙÙ‚Ø· Ù…Ø§Ù‡ Ø¬Ø§Ø±ÛŒ Ø±Ø§ Ø¯Ø±Ø³Øª Ù†Ø´Ø§Ù† Ù…ÛŒØ¯Ù‡Ø¯
           return new Date().getDay(); // Placeholder Ù…Ù†Ø·Ù‚ Ù¾ÛŒÚ†ÛŒØ¯Ù‡ Ø­Ø°Ù Ø´Ø¯ Ø¨Ø±Ø§ÛŒ Ú©ÙˆØªØ§Ù‡ÛŒ
        }

        // --- Ø¢Ù¾Ø¯ÛŒØª Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ ---

        function updateClock() {
            const now = new Date();
            const weekDays = ['ÛŒÚ©Ø´Ù†Ø¨Ù‡', 'Ø¯ÙˆØ´Ù†Ø¨Ù‡', 'Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡', 'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', 'Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡', 'Ø¬Ù…Ø¹Ù‡', 'Ø´Ù†Ø¨Ù‡'];
            const months = ['ÙØ±ÙˆØ±Ø¯ÛŒÙ†', 'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª', 'Ø®Ø±Ø¯Ø§Ø¯', 'ØªÛŒØ±', 'Ù…Ø±Ø¯Ø§Ø¯', 'Ø´Ù‡Ø±ÛŒÙˆØ±', 'Ù…Ù‡Ø±', 'Ø¢Ø¨Ø§Ù†', 'Ø¢Ø°Ø±', 'Ø¯ÛŒ', 'Ø¨Ù‡Ù…Ù†', 'Ø§Ø³ÙÙ†Ø¯'];

            // Ø³Ø§Ø¹Øª
            const timeStr = now.toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
            document.getElementById('time').textContent = timeStr;

            // ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ
            const [jy, jm, jd] = toJalaali(now.getFullYear(), now.getMonth() + 1, now.getDate());
            const dateStr = `${weekDays[now.getDay()]}ØŒ ${jd} ${months[jm-1]} ${jy}`;
            document.getElementById('date-shamsi').textContent = dateStr;
            document.getElementById('date-shamsi').setAttribute('data-full', `${jy}/${jm}/${jd}`);

            // ØªØ§Ø±ÛŒØ® Ù…ÛŒÙ„Ø§Ø¯ÛŒ
            document.getElementById('date-gregorian').textContent = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

            // Ø¨Ø±Ø±Ø³ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯
            const eventKey = `${jm}-${jd}`;
            const eventEl = document.getElementById('event-display');
            if (events[eventKey]) {
                eventEl.textContent = events[eventKey];
                eventEl.style.display = 'inline-block';
            } else {
                eventEl.style.display = 'none';
            }

            // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ØªÙ‚ÙˆÛŒÙ…
            if (currentMonth === 0) {
                currentMonth = jm;
                currentYear = jy;
                renderCalendar(jy, jm, jd);
            }
        }

        function renderCalendar(y, m, todayD) {
            const months = ['ÙØ±ÙˆØ±Ø¯ÛŒÙ†', 'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª', 'Ø®Ø±Ø¯Ø§Ø¯', 'ØªÛŒØ±', 'Ù…Ø±Ø¯Ø§Ø¯', 'Ø´Ù‡Ø±ÛŒÙˆØ±', 'Ù…Ù‡Ø±', 'Ø¢Ø¨Ø§Ù†', 'Ø¢Ø°Ø±', 'Ø¯ÛŒ', 'Ø¨Ù‡Ù…Ù†', 'Ø§Ø³ÙÙ†Ø¯'];
            document.getElementById('calendar-title').textContent = `${months[m-1]} ${y}`;
            
            const container = document.getElementById('calendar-days');
            container.innerHTML = '';

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ù‚ÛŒÙ‚ Ø±ÙˆØ² Ø§ÙˆÙ„ Ù…Ø§Ù‡ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ø®ØªÙ„Ø§Ù Ø±ÙˆØ² Ø¬Ø§Ø±ÛŒ
            const now = new Date();
            const [curY, curM, curD] = toJalaali(now.getFullYear(), now.getMonth()+1, now.getDate());
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ§ØµÙ„Ù‡ Ø±ÙˆØ²Ù‡Ø§
            let dayOfWeekToday = (now.getDay() + 1) % 7; // 0 Ø¨Ø±Ø§ÛŒ Ø´Ù†Ø¨Ù‡
            // Ø§Ú¯Ø± Ø¯Ø§Ø±ÛŒÙ… Ù…Ø§Ù‡ Ø¬Ø§Ø±ÛŒ Ø±Ø§ Ù…ÛŒâ€ŒØ¨ÛŒÙ†ÛŒÙ…
            let startDayOfWeek = 0;
            
            if (y === curY && m === curM) {
                 startDayOfWeek = (dayOfWeekToday - (curD - 1)) % 7;
                 if (startDayOfWeek < 0) startDayOfWeek += 7;
            } else {
                // Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒ Ø¯Ø± Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ ØªÚ© ÙØ§ÛŒÙ„ØŒ ÙÙ‚Ø· Ù…Ø§Ù‡ Ø¬Ø§Ø±ÛŒ Ø¯Ù‚ÛŒÙ‚ Ø§Ø³Øª
                // Ø¨Ø±Ø§ÛŒ Ù…Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± ÛŒÚ© Ø¢ÙØ³Øª ØªØµØ§Ø¯ÙÛŒ Ù†Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ…ØŒ Ø§Ù…Ø§ 
                // Ø¨Ø±Ø§ÛŒ Ù†Ø³Ø®Ù‡ Ú©Ø§Ù…Ù„ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ§Ø¨Ø¹ ØªØ¨Ø¯ÛŒÙ„ Ù…Ø¹Ú©ÙˆØ³ Ø§Ø³Øª.
                startDayOfWeek = 0; // Ù¾ÛŒØ´â€ŒÙØ±Ø¶
            }

            // Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ
            for(let i=0; i<startDayOfWeek; i++) {
                container.innerHTML += `<div class="day empty"></div>`;
            }

            const daysCount = getDaysInJalaliMonth(y, m);
            for(let i=1; i<=daysCount; i++) {
                const isToday = (i === todayD && m === curM && y === curY);
                container.innerHTML += `<div class="day ${isToday ? 'today' : ''}">${i}</div>`;
            }
        }

        function changeMonth(dir) {
            currentMonth += dir;
            if(currentMonth > 12) { currentMonth = 1; currentYear++; }
            if(currentMonth < 1) { currentMonth = 12; currentYear--; }
            // Ù†Ú©ØªÙ‡: Ú†ÙˆÙ† ØªØ§Ø¨Ø¹ ØªØ¨Ø¯ÛŒÙ„ Ù…Ø¹Ú©ÙˆØ³ Ù†Ø¯Ø§Ø±ÛŒÙ…ØŒ Ø±ÙˆØ² "Ø§Ù…Ø±ÙˆØ²" Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù…Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± null Ù…ÛŒâ€ŒÙØ±Ø³ØªÛŒÙ…
            renderCalendar(currentYear, currentMonth, -1);
        }

        // --- Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§ (Open-Meteo API) ---
        async function getWeather(useLocation = false) {
            const descEl = document.getElementById('weather-desc');
            const tempEl = document.getElementById('weather-temp');
            const locEl = document.getElementById('location-text');
            
            descEl.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª...';
            
            let lat = 35.6892, lon = 51.3890; // Ù¾ÛŒØ´â€ŒÙØ±Ø¶ ØªÙ‡Ø±Ø§Ù†

            if (useLocation && navigator.geolocation) {
                try {
                    const pos = await new Promise((resolve, reject) => {
                        navigator.geolocation.getCurrentPosition(resolve, reject);
                    });
                    lat = pos.coords.latitude;
                    lon = pos.coords.longitude;
                    locEl.textContent = 'Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§';
                } catch (e) {
                    locEl.textContent = 'ØªÙ‡Ø±Ø§Ù† (Ø¹Ø¯Ù… Ø¯Ø³ØªØ±Ø³ÛŒ)';
                }
            }

            try {
                const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
                const data = await res.json();
                
                const temp = Math.round(data.current_weather.temperature);
                const code = data.current_weather.weathercode;
                
                tempEl.textContent = `${temp}Â°`;
                
                // ØªÙØ³ÛŒØ± Ú©Ø¯ Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§
                let status = 'ØµØ§Ù';
                let icon = 'â˜€ï¸';
                
                if (code > 0 && code < 3) { status = 'Ú©Ù…ÛŒ Ø§Ø¨Ø±ÛŒ'; icon = 'ğŸŒ¤'; }
                else if (code >= 3 && code < 45) { status = 'Ø§Ø¨Ø±ÛŒ'; icon = 'â˜ï¸'; }
                else if (code >= 45 && code < 60) { status = 'Ù…Ù‡â€ŒØ¢Ù„ÙˆØ¯'; icon = 'ğŸŒ«'; }
                else if (code >= 60 && code < 80) { status = 'Ø¨Ø§Ø±Ø§Ù†ÛŒ'; icon = 'ğŸŒ§'; }
                else if (code >= 80) { status = 'Ø±Ú¯Ø¨Ø§Ø±'; icon = 'â›ˆ'; }
                
                descEl.textContent = status;
                document.getElementById('weather-icon').textContent = icon;

            } catch (error) {
                descEl.textContent = 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª';
            }
        }

        // --- Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ ---
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('light-mode');
            document.getElementById('theme-btn').textContent = isDarkMode ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        function copyDate() {
            const dateText = document.getElementById('date-shamsi').innerText;
            navigator.clipboard.writeText(dateText);
            
            const toast = document.getElementById('toast');
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        // Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡
        setInterval(updateClock, 1000);
        updateClock();
        getWeather(); // Ø¯Ø±ÛŒØ§ÙØª Ù‡ÙˆØ§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
        
    </script>
</body>
</html>
